# Сборка плагина

Этот документ описывает процесс сборки пакета плагина.

## Обзор

Плагин собирается с использованием Vite в качестве инструмента сборки. Процесс сборки настроен для:

- Генерации библиотеки в формате ES модулей
- Создания source maps для отладки
- Генерации файла манифеста со списком всех собранных ресурсов
- Размещения всех артефактов сборки в директории `dist/[название-плагина]`

## Требования

Перед сборкой плагина убедитесь, что у вас установлены:

1. Node.js (рекомендуется версия 18 или выше)
2. Все зависимости установлены через `npm install` в корневой директории

## Конфигурация сборки

Конфигурация сборки находится в файле `frontend/packages/[название-плагина]/vite.config.mts`. Основные настройки сборки включают:

### Настройки вывода

- Директория для сборки: `dist/[название-плагина]`
- Имя библиотеки: определяется в конфигурации
- Формат вывода: только ES модули
- Source maps: включены
- Минификация: отключена (для лучшей отладки)

### Настройки алиасов

- Алиас `@` указывает на корневую директорию frontend

### Артефакты сборки

Процесс сборки генерирует:

- `[название-плагина].[hash].js` - Основной бандл библиотеки
- `[название-плагина].[hash].js.map` - Файл source map
- `manifest.json` - Файл манифеста со списком всех собранных ресурсов

## Команды сборки

Для сборки плагина выполните следующую команду из корневой директории:

```bash
npm run build
```

Или для сборки конкретного пакета:

```bash
npm run build --workspace=[название-пространства]/[название-плагина]
```

## Результаты сборки

После успешной сборки в директории `frontend/dist/[название-плагина]` вы найдете следующие файлы:

- `[название-плагина].[hash].js` - Основной бандл библиотеки
- `[название-плагина].[hash].js.map` - Source map для отладки
- `manifest.json` - Содержит метаданные о сборке:

  ```json
  {
    "name": "[название-плагина]",
    "files": [
      {
        "name": "[название-плагина].js",
        "path": "/dist/[название-плагина]/[название-плагина].js"
      },
      {
        "name": "[название-плагина].js.map",
        "path": "/dist/[название-плагина]/[название-плагина].js.map"
      }
    ]
  }
  ```

## Разработка

Во время разработки вы можете использовать следующие команды:

- `npm run dev` - Запуск сервера разработки
- `npm run build --watch` - Сборка в режиме наблюдения (пересборка при изменении файлов)

## Устранение неполадок

Распространенные проблемы при сборке и их решения:

1. **Ошибка сборки из-за ненайденных модулей**

   - Убедитесь, что все зависимости установлены
   - Проверьте, что алиас `@` правильно разрешается
   - Проверьте правильность всех путей импорта

2. **Не генерируются source maps**

   - Проверьте, что в конфигурации Vite установлено `sourcemap: true`
   - Убедитесь, что процесс сборки завершается без ошибок

3. **Не генерируется манифест**
   - Проверьте, что плагин манифеста включен в плагины Vite
   - Убедитесь, что у процесса сборки есть права на запись в директорию dist

## Дополнительные ресурсы

- [Документация Vite](https://vitejs.dev/guide/)
- [README проекта](../README.md)
- [Документация по рабочим пространствам](./workspaces.md)
